#version 450
#extension GL_EXT_mesh_shader : require

layout(local_size_x = 1, local_size_y = 1, local_size_z = 1) in;
layout(triangles, max_vertices = 4, max_primitives = 2) out;

layout(location = 1) out vec2 uv[];

layout(std140, binding = 0) uniform matrixBuffer {
    mat4 viewProjection;
    float zScale;
};

void main() {
    // Set the number of vertices and primitives to emit
    SetMeshOutputsEXT(4, 2);
    
    // Define quad vertices (two triangles)
    // Vertex 0: bottom-left
    gl_MeshVerticesEXT[0].gl_Position = viewProjection * vec4(-0.5, -0.5, 0.0, 1.0);
    uv[0] = vec2(0.0, 0.0);
    
    // Vertex 1: bottom-right
    gl_MeshVerticesEXT[1].gl_Position = viewProjection * vec4(0.5, -0.5, 0.0, 1.0);
    uv[1] = vec2(1.0, 0.0);
    
    // Vertex 2: top-right
    gl_MeshVerticesEXT[2].gl_Position = viewProjection * vec4(0.5, 0.5, 0.0, 1.0);
    uv[2] = vec2(1.0, 1.0);
    
    // Vertex 3: top-left
    gl_MeshVerticesEXT[3].gl_Position = viewProjection * vec4(-0.5, 0.5, 0.0, 1.0);
    uv[3] = vec2(0.0, 1.0);
    
    // Define two triangles that make up the quad
    // Triangle 0: bottom-left, bottom-right, top-right
    gl_PrimitiveTriangleIndicesEXT[0] = uvec3(0, 1, 2);
    
    // Triangle 1: bottom-left, top-right, top-left
    gl_PrimitiveTriangleIndicesEXT[1] = uvec3(0, 2, 3);
}
